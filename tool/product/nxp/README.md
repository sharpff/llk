## NXP Zigbee 协议

### 1、Cluster ID:

- 0x0000: 基本类
- 0x0006：ON/OFF类
- 0x0008：Level类
- 0x0001：电源管理类
- 0x0406：PIR，人体识别类
- 0x0402：温度测量类
- 0x0405：湿度测量类
- 0x0201: 温控器类

### 2、命令协议

整理数据格式如下:

| head | type |  len | cs | data | tail |
|------|------|------|----| :--: |------| 
|  01  |   2  |   2  |  1 |   -  |  03  |

- head 固定包头
- type 包类型
- len 数据段内容长度
- cs data段的检验和
- data 数据段
- tail 固定包尾

数据段中, 如果出现0x02, 则后面一个字段&0xf代码实际的数据.
数据使用大端格式, 后续重点描述data字段.

#### 2.1、PERMIT JOIN(允许设备加入)

* REQ: 

|  type |  len  |  cs  |   -   | time |  -  |
|-------|-------|------|-------|------|-----| 
| 00 49 | 00 04 |  7E  | FF FC |  30  |  00 |

```
01 00 49 00 04 7E FF FC 30 00 03
01 00    49 00    04    7E FF FC 30 00    03
01 02 10 49 02 10 02 14 7E FF FC 30 02 10 03
```

* RSP:

|  type |  len  |  cs  |      -      |
|-------|-------|------|-------------| 
| 80 00 | 00 04 |  16  | 00 DB 00 49 |

```
01 80 00 00 04 16 00 DB 00 49 03 
01 80 00    00    04    16 00    DB 00    49 03 
01 80 02 10 02 10 02 14 38 02 10 F5 02 10 49 03 
```


#### 2.2、MGR LEAVE(要求设备离网)

* REQ:

|  type |  len  |  cs  |  short addr |           mac           |    -  |
|-------|-------|------|-------------| ----------------------- | ----- |
| 00 47 | 00 0c |  0A  |    E6 CF    | 60 AF 76 33 7E E1 09 74 | 00 00 |

 ```
01 00 47 00 0C 0A E6 CF 60 AF 76 33 7E E1 09 74 00 00 03
01 00    47 00    0C    0A    E6 CF 60 AF 76 33 7E E1 09    74 00    00    03
01 02 10 47 02 10 02 1C 02 1A E6 CF 60 AF 76 33 7E E1 02 19 74 02 10 02 10 03 
```

* RSP:

|  type |  len  |  cs  |      -      |
|-------|-------|------|-------------| 
| 80 00 | 00 04 |  BD  | 00 7E 00 47 |

 ```
 01 80 00 00 04 BD 00 7E 00 47 03
 01 80 00    00    04    BD    00 7E 00    47 03
 01 80 02 10 02 10 02 14 BD 02 10 7E 02 10 47 03
 ```


#### 2.3、SET CHANNEL(设备信道)

|  type |  len  |  cs  |  channel  |   -   |
|-------|-------|------|-----------|-------| 
| 00 21 | 00 04 |  2D  |  00 00 08 |   00  |

```
channel 11:

01 00 21 00 04 2D 00 00 08 00 03 
01 00    21 00    04    2D 00    00    08    00    03 
01 02 10 21 02 10 02 14 2D 02 10 02 10 02 18 02 10 03 

channel 11: 01 00 21 00 04 2D 00 00 08 00 03 
channel 12: 01 00 21 00 04 35 00 00 10 00 03 
channel 13: 01 00 21 00 04 35 00 00 20 00 03 
channel 14: 01 00 21 00 04 35 00 00 40 00 03 
channel 15: 01 00 21 00 04 35 00 00 80 00 03 
channel 16: 01 00 21 00 04 35 00 01 00 00 03 
channel 17: 01 00 21 00 04 35 00 02 00 00 03 
channel 18: 01 00 21 00 04 35 00 04 00 00 03 
channel 19: 01 00 21 00 04 35 00 08 00 00 03 
channel 20: 01 00 21 00 04 35 00 10 00 00 03 
channel 21: 01 00 21 00 04 35 00 20 00 00 03 
channel 22: 01 00 21 00 04 35 00 40 00 00 03 
channel 23: 01 00 21 00 04 35 00 80 00 00 03 
channel 24: 01 00 21 00 04 35 01 00 00 00 03 
channel 25: 01 00 21 00 04 27 02 00 00 00 03 
channel 26: 01 00 21 00 04 27 04 00 00 00 03 
```


#### 2.4、DEVICE ANNOUNCE(设备入网Join)

|  type |  len  |  cs  | short addr |          mac            | -  |
|-------|-------|------|:----------:|-------------------------|----|
| 00 4D | 00 0B |  5A  |    BE 4A   | 60 AF 76 33 7E E1 09 74 | 80 |

```
btn: 

01 00 4D 00 0B 5A BE 4A 60 AF 76 33 7E E1 09 74 80 03 
01 00    4D 00    0B    5A BE 4A 60 AF 76 33 7E E1 09    74 80 03 
01 02 10 4d 02 10 02 1b 5a be 4a 60 af 76 33 7e e1 02 19 74 80 03 
```


#### 2.5、LEAVE IND(设备)

|  type |  len  |  cs  |           mac           | -  |
|-------|-------|------|-------------------------|----|
| 80 48 | 00 09 |  C4  | 00 15 8D 00 00 F3 A0 CE | 00 |

```
btn: 

01 80 48 00 09 C4 00 15 8D 00 00 F3 A0 CE 00 03 
01 80 48 00    09    C4 00    15 8D 00    00    F3 A0 CE 00    03 
01 80 48 02 10 02 19 C4 02 10 15 8D 02 10 02 10 F3 A0 CE 02 10 03
```


#### 2.6、恢复Gateway到出厂设置：

* REQ

```
01 00 11 00 00 11 03
01 00    11 00    00    11 03
01 02 10 11 02 10 02 10 11 03
```

* RSP

```
01 80 06 00 01 86 01 03
01 80 06    00    01    86 01    03
01 80 02 16 02 10 02 11 86 02 11 03 
```


#### 2.7、状态变化通知


* sensor类

| type  |  len  | cs | sq | short addr | ept | clu id |      -      | attr |
|-------|-------|----|----|:----------:|:---:|:------:|:-----------:|:----:|
| 81 02 | 00 0B | 62 | 04 |    B4 4C   |  01 | 00 06  | 00 00 00 10 |  01  |

```
btn pressed:

01 81 02 00 0B 62 04 B4 4C 01 00 06 00 00 00 10 01 03 
01 81 02    00    0B 62 04    B4 4C 01    00    06    00    00    00    10 01    03 
01 81 02 12 02 10 0B 62 02 14 B4 4C 02 11 02 10 02 16 02 10 02 10 02 10 10 02 11 03

heart:

01 81 02 00 0B AA 91 6E C7 01 04 06 00 00 00 18 01 03 
01 81 02    00    0B AA 91 6E C7 01    04    06    00    00    00    18 01    03 
01 81 02 12 02 10 0B AA 91 6E C7 02 11 02 14 02 16 02 10 02 10 02 10 18 02 11 03
```

* ctrl类

| type  |  len  | cs | -  | short addr |     -    |
|-------|-------|----|----|:----------:|----------|
| 00 92 | 00 06 | D4 | 02 |    31 71   | 01 01 02 |

```
light:

01 00 92 00 06 D4 02 31 71 01 01 02 03 
01 00    92    00    06 D4 02    31 71    01    01    02 03
01 02 10 92 02 10 02 16 D4 02 12 31 71 02 11 02 11 02 12 03
```

* IAS类

| type  |  len  | cs | -  |ept | clu id |  - | short addr |  attr  |
|-------|-------|----|----|----|:------:|----|:----------:|--------|
| 84 01 | 00 0D | 2B | 0C | 01 | 05 00  | 02 |    9F 36   |  00 01 |

```
01 84 01 00 0D 2B 0C 01 05 00 02 9F 36 00 01 00 00 00 01 03 !!
```

#### 2.8、ACTIVE(List)

* active request:

| type  |  len  | cs | short addr |
|-------|-------|----|:----------:|
| 00 45 | 00 02 | 13 |    DB 8F   |

```
01 00 45 00 02 13 DB 8F 03 
01 02 10 45 02 10 02 12 13 DB 8F 03
```

* active response:

| type  |  len  | cs |   -   | short addr | ept cnt | ept... |
|-------|-------|----|:-----:|:----------:|:-------:|:------:|
| 80 45 | 00 06 | 7F | E8 00 |    DB 8F   |    01   | 01 ... |

```
01 80 45 00 06 7F E8 00 DB 8F 01 01 03 
01 80 45 02 10 02 16 7f e8 02 10 db 8f 02 11 02 11 03 
```

#### 2.9、SIMPLE DESCRIPTOR(Info)

* simple descriptor request:

| type  |  len  | cs | short addr | ept |
|-------|-------|----|:----------:|-----|
| 00 43 | 00 03 | 15 |    DB 8F   | 01  |

```
01 00 43 00 03 15 DB 8F 01 03 
01 02 10 43 02 10 02 13 15 DB 8F 02 11 03
```

* simple descriptor response:

| type  |  len  | cs |   -   | short addr |  -  | ept |  pid  |  did  |  -  | clu in cnt | cluid... |clu out cnt | cluid... |  -  |
|-------|-------|----|-------|:----------:|-----|-----|:-----:|:-----:|-----|:----------:|:--------:|:----------:|:--------:|-----|
| 80 43 | 00 25 | 4C | E9 00 |    DB 8F   |  16 |  01 | 01 04 | 01 01 |  02 |     06     | 00 00 ...|     01     | 00 00 ...| ... |

```
01 80 43 00 25 4C E9 00 DB 8F 16 01 01 04 01 01 02 06 00 00 00 04 00 03 00 06 00 08 00 05 01 00 00 00 04 00 03 00 06 00 08 00 05 03 
01 80 43 02 10 25 4c e9 02 10 db 8f 16 02 11 02 11 02 14 02 11 02 11 02 12 02 16 02 10 02 10 02 10 02 14 02 10 02 13 02 10 02 16 02 10 02 18 02 10 02 15 02 11 02 10 02 10 02 10 02 14 02 10 02 13 02 10 02 16 02 10 02 18 02 10 02 15 03
```

#### 2.10、NODE DESCRIPTOR(Man)

* node descriptor request:

| type  |  len  | cs | short addr |
|-------|-------|----|:----------:|
| 00 42 | 00 02 | 14 |    DB 8F   |

```
01 00 42 00 02 14 DB 8F 03 
01 02 00 42 02 10 02 12 14 DB 8F 03
```

* node descriptor response:

| type  |  len  | cs |   -   | short addr |  man  |              -                  |
|-------|-------|----|-------|:----------:|-------|---------------------------------|
| 80 42 | 00 11 | 75 | 65 00 |    DB 8F   | 10 37 |00 64 00 64 00 00 00 8E 7F 40 01 |
```
01 80 42 00 11 75 65 00 DB 8F 10 37 00 64 00 64 00 00 00 8E 7F 40 01 03
01 80 42 02 10 11 75 65 02 10 DB 8F 10 37 02 10 64 02 10 64 02 10 02 10 02 10 8E 7F 40 02 11 03
```

#### 3、Lelink 封装

```
{
    "status":{
        "pwr":1,
        "mark":2,
        "actions":3
    },
    "cloud":1,
    "uuid":"d05bca44feb34aeca2dd111111111111",
    "ip":"192.168.1.100",
    "ver":"3-1.0.0.git.004-161-g7b08f3c.1-1-1.1",
    "ssid":"",
    "lock":0,
    "uuids":[

    ],
    "sDevStatus":{
        "btn":1
    },
    "sDev":{
        "des":[
            {
                "ept":1,
                "did":"0101",
                "clu":[
                    "0000",
                    "0004",
                    "0004",
                    "0004",
                    "0004"
                ]
            }
        ],
        "man":"1234",
        "pid":"0104",
        "mac":"7409E17E3376AF60"
    }
}

{
    "sDevCtrl":{
        "pwr":1
    },
    "sDev":
    {
        "ept":1,
        "did":"0101",
        "clu":"0006",
        "mac":"7409E17E3376AF60"
    }
}
```
